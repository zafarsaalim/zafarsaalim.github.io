<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Inventory & Bundle Manager</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { font-family: Arial, sans-serif; padding: 1rem; max-width: 800px; margin: auto; }
    h2 { margin-top: 2rem; }
    input, button, select { padding: 0.5rem; margin: 0.25rem; }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    th, td { border: 1px solid #ccc; padding: 0.5rem; text-align: left; }                                       th { background: #f5f5f5; }
    .section { margin-bottom: 2rem; }
  </style>
</head>
<body>                                                
<h1>ðŸ“¦ Inventory & Bundle Manager</h1>

<div class="section">
  <h2>Add Item</h2>
  <input type="text" id="sku" placeholder="SKU">
  <input type="text" id="name" placeholder="Item Name">
  <input type="number" id="qty" placeholder="Qty" min="1">
  <button onclick="addItem()">Add/Update</button>
</div>

<div class="section">
  <h2>Inventory</h2>
  <table>
    <thead>
      <tr><th>SKU</th><th>Name</th><th>Qty</th></tr>
    </thead>
    <tbody id="inventoryTable"></tbody>
  </table>
</div>

<div class="section">
  <h2>Create Bundle</h2>
  <input type="text" id="bundleName" placeholder="Bundle Name">
  <textarea id="bundleItems" rows="3" style="width:100%;" placeholder="Enter SKUs like: sku1:2, sku2:1"></textarea>
  <button onclick="addBundle()">Save Bundle</button>
</div>

<div class="section">
  <h2>Bundles</h2>
  <table>
    <thead>
      <tr><th>Bundle</th><th>Items</th><th>Max Qty</th><th>Action</th></tr>
    </thead>
    <tbody id="bundleTable"></tbody>
  </table>
</div>

<script>
let inventory = JSON.parse(localStorage.getItem('inventory') || '{}');
let bundles = JSON.parse(localStorage.getItem('bundles') || '{}');

function saveData() {
  localStorage.setItem('inventory', JSON.stringify(inventory));
  localStorage.setItem('bundles', JSON.stringify(bundles));
  renderInventory();
  renderBundles();
}

function addItem() {
  const sku = document.getElementById('sku').value.trim();
  const name = document.getElementById('name').value.trim();
  const qty = parseInt(document.getElementById('qty').value, 10);

  if (!sku || !name || isNaN(qty)) return alert('Fill all fields correctly');

  if (!inventory[sku]) inventory[sku] = { name: name, qty: 0 };
  inventory[sku].name = name;
  inventory[sku].qty += qty;

  document.getElementById('sku').value = '';
  document.getElementById('name').value = '';
  document.getElementById('qty').value = '';

  saveData();
}

function renderInventory() {
  const tbody = document.getElementById('inventoryTable');
  tbody.innerHTML = '';
  Object.entries(inventory).forEach(([sku, item]) => {
    tbody.innerHTML += `<tr><td>${sku}</td><td>${item.name}</td><td>${item.qty}</td></tr>`;
  });
}

function parseBundleItems(text) {
  const items = {};
  text.split(',').forEach(pair => {
    const [sku, qty] = pair.trim().split(':');
    if (sku && qty) items[sku.trim()] = parseInt(qty.trim(), 10);
  });
  return items;
}

function addBundle() {
  const name = document.getElementById('bundleName').value.trim();
  const raw = document.getElementById('bundleItems').value.trim();
  if (!name || !raw) return alert('Fill both fields');

  const items = parseBundleItems(raw);
  if (Object.keys(items).length === 0) return alert('Invalid items format');

  for (let sku in items) {
    if (!inventory[sku]) return alert(`Unknown SKU in bundle: ${sku}`);
  }

  bundles[name] = items;

  document.getElementById('bundleName').value = '';
  document.getElementById('bundleItems').value = '';

  saveData();
}

function getMaxBundleQty(bundle) {
  let min = Infinity;
  for (let sku in bundle) {
    const have = inventory[sku]?.qty || 0;
    const need = bundle[sku];
    const possible = Math.floor(have / need);
    if (possible < min) min = possible;
  }
  return min;
}

function useBundle(name) {
  const bundle = bundles[name];
  const maxQty = getMaxBundleQty(bundle);
  if (maxQty < 1) return alert('Not enough stock to make this bundle');

  for (let sku in bundle) {
    inventory[sku].qty -= bundle[sku];
  }

  saveData();
}

function renderBundles() {
  const tbody = document.getElementById('bundleTable');
  tbody.innerHTML = '';
  Object.entries(bundles).forEach(([name, items]) => {
    const itemStr = Object.entries(items).map(([s, q]) => `${s}:${q}`).join(', ');
    const maxQty = getMaxBundleQty(items);
    tbody.innerHTML += `<tr>
      <td>${name}</td>
      <td>${itemStr}</td>
      <td>${maxQty}</td>
      <td><button onclick="useBundle('${name}')">Assemble</button></td>
    </tr>`;
  });
}

// Initial render
renderInventory();
renderBundles();
</script>

</body>
</html>
